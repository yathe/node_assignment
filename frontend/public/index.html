<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Platform</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .search-container {
            margin: 20px 0;
            display: flex;
            gap: 10px;
        }
        .search-container input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-container button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .post {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .post h2 {
            margin-top: 0;
            color: #333;
        }
        .post-meta {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .tags {
            margin: 10px 0;
        }
        .tag {
            display: inline-block;
            background: #e0e0e0;
            padding: 2px 8px;
            margin: 2px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }
        .pagination button {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
        }
        .pagination button:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }
        .loading {
            text-align: center;
            padding: 20px;
        }
        .error {
            color: red;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Blog Platform</h1>
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Search posts by title, content, or tags...">
            <button onclick="searchPosts()">Search</button>
            <button onclick="clearSearch()">Clear</button>
        </div>
    </div>
    
    <div id="posts-container">
        <div class="loading">Loading posts...</div>
    </div>

    <div class="pagination" id="pagination" style="display: none;">
        <button id="prevBtn" onclick="changePage(-1)">Previous</button>
        <span id="pageInfo">Page 1 of 1</span>
        <button id="nextBtn" onclick="changePage(1)">Next</button>
    </div>

    <script>
        const API_BASE_URL = 'https://your-backend-url.onrender.com/api'; // Update with your deployed backend URL
        let currentPage = 1;
        let currentSearch = '';
        let totalPages = 1;

        async function fetchPosts(page = 1, search = '') {
            try {
                document.getElementById('posts-container').innerHTML = '<div class="loading">Loading posts...</div>';
                
                const params = new URLSearchParams({
                    page: page,
                    limit: 5,
                    ...(search && { search: search })
                });

                const response = await fetch(`${API_BASE_URL}/posts?${params}`);
                if (!response.ok) {
                    throw new Error('Failed to fetch posts');
                }
                const data = await response.json();
                displayPosts(data.posts);
                updatePagination(data.pagination);
            } catch (error) {
                console.error('Error fetching posts:', error);
                document.getElementById('posts-container').innerHTML =
                    '<div class="error">Failed to load posts. Please try again later.</div>';
            }
        }

        function displayPosts(posts) {
            const container = document.getElementById('posts-container');

            if (posts.length === 0) {
                container.innerHTML = '<p>No posts available.</p>';
                return;
            }

            const postsHtml = posts.map(post => `
                <div class="post">
                    <h2>${post.title}</h2>
                    <div class="post-meta">
                        By ${post.author.username} on ${new Date(post.createdAt).toLocaleDateString()}
                        ${post.status === 'draft' ? ' (Draft)' : ''}
                    </div>
                    ${post.tags && post.tags.length > 0 ? `
                        <div class="tags">
                            ${post.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    <div class="content">
                        ${post.content.length > 300 ? post.content.substring(0, 300) + '...' : post.content}
                    </div>
                </div>
            `).join('');

            container.innerHTML = postsHtml;
        }

        function updatePagination(pagination) {
            const paginationContainer = document.getElementById('pagination');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const pageInfo = document.getElementById('pageInfo');

            currentPage = pagination.currentPage;
            totalPages = pagination.totalPages;

            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;

            paginationContainer.style.display = totalPages > 1 ? 'flex' : 'none';
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                fetchPosts(newPage, currentSearch);
            }
        }

        function searchPosts() {
            const searchTerm = document.getElementById('searchInput').value;
            currentSearch = searchTerm;
            currentPage = 1;
            fetchPosts(currentPage, currentSearch);
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            currentSearch = '';
            currentPage = 1;
            fetchPosts(currentPage, currentSearch);
        }

        // Load posts on page load
        fetchPosts();
    </script>
</body>
</html>